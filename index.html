<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ú–æ–π –ø–∏—Ç–æ–º–µ—Ü üê±</title>
<style>
  :root{
    --bg1:#f9f9f9;
    --bg2:#e8f4ff;
    --card:#fff;
    --muted:#666;
    --gold:#ffd166;
    --blue:#4cc9f0;
    --green:#06d6a0;
    --accent:#118ab2;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, "Segoe UI", Tahoma, sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
  }
  .card{
    width: 360px;
    max-width:100%;
    background:var(--card);
    border-radius:16px;
    padding:18px;
    box-shadow:0 6px 20px rgba(0,0,0,0.12);
    position:relative;
  }

  /* notification strip */
  #notification{
    position:absolute;
    top:-44px;
    left:50%;
    transform:translateX(-50%);
    padding:8px 14px;
    border-radius:20px;
    font-weight:600;
    font-size:14px;
    box-shadow:0 6px 12px rgba(0,0,0,0.12);
    opacity:0;
    transition:all .35s ease;
    pointer-events:none;
  }
  #notification.show{ top:-14px; opacity:1 }
  #notification.coins{ background:var(--gold); color:#333 }
  #notification.exp{ background:var(--blue); color:#fff }
  #notification.buy{ background:#8b5cf6; color:#fff }

  h1{ font-size:20px; margin:0 0 6px 0; text-align:center }
  #pet-emoji{ font-size:72px; display:block; text-align:center; filter:drop-shadow(0 0 10px gold); animation:glow 2s ease-in-out infinite alternate; margin:6px 0 12px; }
  @keyframes glow { from{filter:drop-shadow(0 0 6px gold)} to{filter:drop-shadow(0 0 18px gold)} }

  .row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin:6px 0}
  .stat{font-weight:700}
  .muted{color:var(--muted); font-size:13px}

  button{
    border:0;
    border-radius:10px;
    padding:11px;
    font-size:15px;
    cursor:pointer;
  }
  .btn-block{width:100%; display:block}
  .feed{background:var(--gold)}
  .feed[disabled]{opacity:.6;cursor:default}
  .bonus{background:var(--green)}
  .mini{background:var(--accent); color:#fff}
  .nav{background:#efefef}
  .small{padding:8px 10px; font-size:13px}

  #timer-feed,#timer-bonus,#timer-mulcoins,#timer-mulexp,#timer-catch{color:var(--muted); font-size:13px; margin-top:6px}

  /* mini-game area hidden by default */
  #mini-game-area{ display:none; margin-top:10px; }
  #mini-game-area input{ width:100%; padding:8px; margin-top:8px; border-radius:8px; border:1px solid #ddd; font-size:15px; text-align:center }

  /* shop / catch pages */
  .page{ display:none }
  .page.active{ display:block }
  .nav-row{ display:flex; gap:8px; margin-top:8px }
  .shop-item{ display:flex; justify-content:space-between; align-items:center; padding:10px; border-radius:10px; background:#fafafa; margin-top:8px }
  .grid{ display:grid; gap:6px; grid-template-columns:repeat(5,1fr); margin-top:10px }
  .cell{ background:#fff; border-radius:8px; height:54px; display:flex; align-items:center; justify-content:center; font-size:24px; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,0.06) }
  .cell.disabled{opacity:.5; cursor:default}
  .home-btn{ background:#efefef; border-radius:10px; padding:8px; font-size:14px }
  .bottom-row{ margin-top:12px; display:flex; gap:8px }
</style>
</head>
<body>
  <div class="card" role="application">
    <div id="notification" aria-live="polite"></div>

    <!-- MAIN PAGE -->
    <div id="page-main" class="page active">
      <div style="text-align:center">
        <div id="pet-emoji">üê±</div>
        <h1>–ú–æ–π –ø–∏—Ç–æ–º–µ—Ü</h1>
      </div>

      <div class="row">
        <div>
          <div class="stat" id="level">–£—Ä–æ–≤–µ–Ω—å: 1</div>
          <div class="muted" id="progress">–ü—Ä–æ–≥—Ä–µ—Å—Å: 0%</div>
        </div>
        <div style="text-align:right">
          <div class="stat" id="coins">–ú–æ–Ω–µ—Ç—ã: 10</div>
          <div class="muted" id="coins-extra"> </div>
        </div>
      </div>

      <!-- multipliers display -->
      <div id="timer-mulcoins"></div>
      <div id="timer-mulexp"></div>

      <div style="margin-top:10px">
        <button id="feed-btn" class="btn-block feed">–ü–æ–∫–æ—Ä–º–∏—Ç—å</button>
        <div id="timer-feed" class="muted"></div>

        <button id="bonus-btn" class="btn-block bonus" style="margin-top:8px">–ë–æ–Ω—É—Å</button>
        <div id="timer-bonus" class="muted"></div>

        <button id="mini-game-btn" class="btn-block mini" style="margin-top:8px">–ú–∏–Ω–∏-–∏–≥—Ä–∞</button>
        <div id="mini-game-area">
          <div id="mini-task" class="muted"></div>
          <input id="mini-answer" type="number" placeholder="–û—Ç–≤–µ—Ç" />
          <div class="bottom-row">
            <button id="mini-submit" class="btn-block small" style="flex:1;background:#118ab2;color:#fff;border-radius:8px">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button id="mini-cancel" class="home-btn" style="flex:1">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>

        <div style="display:flex; gap:8px; margin-top:10px">
          <button id="open-shop" class="nav-btn nav" style="flex:1">–ë–æ–Ω—É—Å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</button>
          <button id="open-catch" class="nav-btn nav" style="flex:1">–û—Ç–ª–æ–≤</button>
        </div>

        <div id="timer-catch" class="muted" style="margin-top:8px"></div>
      </div>
    </div>

    <!-- SHOP PAGE -->
    <div id="page-shop" class="page">
      <div style="display:flex; align-items:center; justify-content:space-between">
        <div>
          <h1 style="margin:0">–ë–æ–Ω—É—Å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</h1>
          <div class="muted">–ö—É–ø–∏—Ç–µ —É—Å–∏–ª–µ–Ω–∏—è ‚Äî –∏—Ö –º–æ–∂–Ω–æ –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å</div>
        </div>
        <button id="shop-home" class="home-btn">–î–æ–º–æ–π</button>
      </div>

      <div class="shop-item">
        <div>
          <div style="font-weight:700">x2 –ú–æ–Ω–µ—Ç</div>
          <div class="muted">–î–µ–π—Å—Ç–≤—É–µ—Ç 10 –º–∏–Ω—É—Ç, —É–¥–≤–∞–∏–≤–∞–µ—Ç –º–æ–Ω–µ—Ç—ã –æ—Ç –¥–µ–π—Å—Ç–≤–∏–π</div>
        </div>
        <div style="text-align:right">
          <div id="shop-coins-time" class="muted">–û—Å—Ç–∞–ª–æ—Å—å: ‚Äî</div>
          <button id="buy-coins" class="small" style="margin-top:8px;background:var(--gold)">–ö—É–ø–∏—Ç—å / –ü—Ä–æ–¥–ª–∏—Ç—å</button>
        </div>
      </div>

      <div class="shop-item">
        <div>
          <div style="font-weight:700">x2 –û–ø—ã—Ç</div>
          <div class="muted">–î–µ–π—Å—Ç–≤—É–µ—Ç 15 –º–∏–Ω—É—Ç, —É–¥–≤–∞–∏–≤–∞–µ—Ç –æ–ø—ã—Ç –æ—Ç –¥–µ–π—Å—Ç–≤–∏–π</div>
        </div>
        <div style="text-align:right">
          <div id="shop-exp-time" class="muted">–û—Å—Ç–∞–ª–æ—Å—å: ‚Äî</div>
          <button id="buy-exp" class="small" style="margin-top:8px;background:var(--blue);color:#fff">–ö—É–ø–∏—Ç—å / –ü—Ä–æ–¥–ª–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- CATCH PAGE -->
    <div id="page-catch" class="page">
      <div style="display:flex; align-items:center; justify-content:space-between">
        <div>
          <h1 style="margin:0">–û—Ç–ª–æ–≤ –∂–∏–≤–æ—Ç–Ω—ã—Ö</h1>
          <div class="muted">–ü–æ–ª–µ 5√ó5 ‚Äî –Ω–∞–∂–º–∏ –Ω–∞ —ç–º–æ–¥–∑–∏, —á—Ç–æ–±—ã –ø–æ–π–º–∞—Ç—å</div>
        </div>
        <button id="catch-home" class="home-btn">–î–æ–º–æ–π</button>
      </div>

      <div id="catch-grid" class="grid"></div>

      <div style="display:flex; gap:8px; margin-top:10px">
        <button id="refresh-grid" class="small" style="flex:1">–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ</button>
        <button id="catch-clear" class="small" style="flex:1">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ</button>
      </div>

      <div id="catch-note" class="muted" style="margin-top:8px">–ò–≥—Ä–∞—Ç—å –º–æ–∂–Ω–æ —Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç</div>
    </div>

  </div>

<script>
/* ======== State & persistence ======== */
const SAVE_KEY = 'petGameState_v2';
let state = {
  level:1,
  progress:0,
  coins:10,
  // feed: 5 uses then reset at feedRestoreAt (timestamp ms)
  feedCount:5,
  feedRestoreAt:0,
  // bonus button (30s) available at bonusAvailableAt
  bonusAvailableAt:0,
  // multiplier timestamps (ms) until when active
  coinMultUntil:0,
  expMultUntil:0,
  // catch cooldown: allowed at or after catchAvailableAt
  catchAvailableAt:0,
};

function saveState(){ localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }
function loadState(){ try{ const s=localStorage.getItem(SAVE_KEY); if(s) state = Object.assign(state, JSON.parse(s)); }catch(e){} }

/* ======== UI refs ======== */
const notification = document.getElementById('notification');
const levelEl = document.getElementById('level');
const progressEl = document.getElementById('progress');
const coinsEl = document.getElementById('coins');
const coinsExtra = document.getElementById('coins-extra');

const feedBtn = document.getElementById('feed-btn');
const timerFeedEl = document.getElementById('timer-feed');

const bonusBtn = document.getElementById('bonus-btn');
const timerBonusEl = document.getElementById('timer-bonus');

const miniBtn = document.getElementById('mini-game-btn');
const miniArea = document.getElementById('mini-game-area');
const miniTask = document.getElementById('mini-task');
const miniAnswer = document.getElementById('mini-answer');
const miniSubmit = document.getElementById('mini-submit');
const miniCancel = document.getElementById('mini-cancel');

const openShop = document.getElementById('open-shop');
const pageMain = document.getElementById('page-main');
const pageShop = document.getElementById('page-shop');
const pageCatch = document.getElementById('page-catch');
const shopHome = document.getElementById('shop-home');
const catchHome = document.getElementById('catch-home');

const shopCoinsTime = document.getElementById('shop-coins-time');
const shopExpTime = document.getElementById('shop-exp-time');
const buyCoins = document.getElementById('buy-coins');
const buyExp = document.getElementById('buy-exp');

const timerMulCoins = document.getElementById('timer-mulcoins');
const timerMulExp = document.getElementById('timer-mulexp');

const openCatch = document.getElementById('open-catch');
const catchGrid = document.getElementById('catch-grid');
const refreshGrid = document.getElementById('refresh-grid');
const clearGrid = document.getElementById('catch-clear');
const timerCatchEl = document.getElementById('timer-catch');

/* ======== Helpful helpers ======== */
function nowMs(){ return Date.now(); }
function formatRemaining(ms){
  if(ms<=0) return '‚Äî';
  let s = Math.max(0, Math.ceil(ms/1000));
  let m = Math.floor(s/60);
  let sec = s % 60;
  return `${m}:${sec.toString().padStart(2,'0')}`;
}
function showNotification(type, text){
  notification.textContent = text;
  notification.className = '';
  notification.classList.add('show', type);
  // if buy notification, keep slightly longer
  const timeout = (type==='buy')? 3000 : 2200;
  setTimeout(()=> notification.classList.remove('show'), timeout);
}

/* ======== Core gameplay functions ======== */
function updateUI(){
  levelEl.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${state.level}`;
  progressEl.textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${state.progress.toFixed(1)}%`;
  coinsEl.textContent = `–ú–æ–Ω–µ—Ç—ã: ${state.coins}`;
  // feed button
  feedBtn.textContent = `–ü–æ–∫–æ—Ä–º–∏—Ç—å (${state.feedCount})`;
  feedBtn.disabled = state.feedCount <= 0;
  // bonus
  const bonusReady = nowMs() >= state.bonusAvailableAt;
  bonusBtn.disabled = !bonusReady;
  // multipliers time displays
  const cRem = Math.max(0, state.coinMultUntil - nowMs());
  const eRem = Math.max(0, state.expMultUntil - nowMs());
  timerMulCoins.textContent = cRem>0 ? `x2 –º–æ–Ω–µ—Ç ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å ${formatRemaining(cRem)}` : '';
  timerMulExp.textContent = eRem>0 ? `x2 –æ–ø—ã—Ç–∞ ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å ${formatRemaining(eRem)}` : '';
  shopCoinsTime.textContent = cRem>0 ? `–û—Å—Ç–∞–ª–æ—Å—å: ${formatRemaining(cRem)}` : '–û—Å—Ç–∞–ª–æ—Å—å: ‚Äî';
  shopExpTime.textContent = eRem>0 ? `–û—Å—Ç–∞–ª–æ—Å—å: ${formatRemaining(eRem)}` : '–û—Å—Ç–∞–ª–æ—Å—å: ‚Äî';
  // catch timer
  const catchRem = Math.max(0, state.catchAvailableAt - nowMs());
  timerCatchEl.textContent = catchRem>0 ? `–°–ª–µ–¥—É—é—â–∏–π –æ—Ç–ª–æ–≤: ${formatRemaining(catchRem)}` : '–û—Ç–ª–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω';
  timerFeedEl.textContent = (state.feedCount>0) ? '' : `–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑: ${formatRemaining(Math.max(0, state.feedRestoreAt - nowMs()))}`;
  timerBonusEl.textContent = bonusReady ? '' : `–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑: ${formatRemaining(Math.max(0, state.bonusAvailableAt - nowMs()))}`;
  // coinsExtra (show if multiplier active)
  coinsExtra.textContent = (cRem>0 || eRem>0) ? ((cRem>0?'x2 –º–æ–Ω–µ—Ç ':'') + (eRem>0?'x2 –æ–ø—ã—Ç–∞':'')) : '';
}

/* apply multipliers to coin/exp amounts */
function applyCoinMultiplier(amount){
  if(state.coinMultUntil > nowMs()) return Math.round(amount * 2);
  return amount;
}
function applyExpMultiplier(amount){
  if(state.expMultUntil > nowMs()) return amount * 2;
  return amount;
}

function increaseProgress(amount){
  state.progress += amount;
  // level up loop
  while(state.progress >= 100){
    state.progress -= 100;
    state.level++;
  }
  if(state.progress < 0) state.progress = 0;
}

/* ======== Feeding ======== */
/* On click: if feedCount>0 then:
   - first feed in batch (feedCount==5) gives +2 level (we'll convert to 2%?) ‚Äî keep as +2 level per earlier requirement
   - each feed gives +0.75% progress
*/
feedBtn.addEventListener('click', ()=>{
  if(state.feedCount<=0) return;
  // first feed special +2 level
  if(state.feedCount === 5){
    state.level += 2; // as requested: "–ü–µ—Ä–≤–æ–µ –∫–æ—Ä–º–ª–µ–Ω–∏–µ –¥–∞—ë—Ç +2 –∫ —É—Ä–æ–≤–Ω—é"
    showNotification('exp', `–í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ +2 —É—Ä–æ–≤–Ω—è`);
  }
  const expGain = applyExpMultiplier(0.75);
  increaseProgress(expGain);
  showNotification('exp', `–í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ +${expGain}% –æ–ø—ã—Ç–∞`);
  state.feedCount--;
  if(state.feedCount <= 0){
    // set restore at now + 2 minutes
    state.feedRestoreAt = nowMs() + 2*60*1000;
  }
  saveState();
  updateUI();
});

/* tick to restore feed if time passed */
function checkFeedRestore(){
  if(state.feedCount <= 0 && state.feedRestoreAt && nowMs() >= state.feedRestoreAt){
    state.feedCount = 5;
    state.feedRestoreAt = 0;
    saveState();
    updateUI();
  }
}

/* ======== Bonus button ======== */
bonusBtn.addEventListener('click', ()=>{
  if(nowMs() < state.bonusAvailableAt) return;
  const rewardIsCoins = Math.random() < 0.5;
  if(rewardIsCoins){
    const amount = Math.floor(Math.random()*3)+1; // 1..3
    const final = applyCoinMultiplier(amount);
    state.coins += final;
    showNotification('coins', `+${final} –±–æ–Ω—É—Å–Ω—ã—Ö –º–æ–Ω–µ—Ç`);
  } else {
    const amount = +(Math.random()*0.6 + 0.2).toFixed(2); // 0.2..0.8
    const final = applyExpMultiplier(amount);
    increaseProgress(final);
    showNotification('exp', `+${final}% –±–æ–Ω—É—Å–Ω–æ–≥–æ –æ–ø—ã—Ç–∞`);
  }
  // set 30s cooldown
  state.bonusAvailableAt = nowMs() + 30*1000;
  saveState();
  updateUI();
});

/* ======== Mini-game (arithmetic) ======== */
let currentMiniAnswer = null;
miniBtn.addEventListener('click', ()=>{
  miniArea.style.display = 'block';
  const a = Math.floor(Math.random()*50)+1;
  const b = Math.floor(Math.random()*50)+1;
  const ops = ['+','-','*'];
  const op = ops[Math.floor(Math.random()*ops.length)];
  miniTask.textContent = `–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç ${a} ${op} ${b}?`;
  switch(op){
    case '+': currentMiniAnswer = a+b; break;
    case '-': currentMiniAnswer = a-b; break;
    case '*': currentMiniAnswer = a*b; break;
  }
  miniAnswer.value = '';
  miniAnswer.focus();
});
miniCancel.addEventListener('click', ()=> miniArea.style.display='none');

miniSubmit.addEventListener('click', ()=>{
  const ans = Number(miniAnswer.value);
  if(!miniArea || miniArea.style.display === 'none') return;
  if(ans === currentMiniAnswer){
    // correct
    const addedCoins = applyCoinMultiplier(1);
    state.coins += addedCoins;
    const addedExp = applyExpMultiplier(0.1);
    increaseProgress(addedExp);
    showNotification('coins', `+${addedCoins} –º–æ–Ω–µ—Ç–∞, +${addedExp}% –æ–ø—ã—Ç–∞`);
  } else {
    // wrong
    state.coins = Math.max(0, state.coins - 1);
    const penalty = applyExpMultiplier(-0.5);
    increaseProgress(penalty);
    showNotification('exp', `-0.5% –æ–ø—ã—Ç–∞, -1 –º–æ–Ω–µ—Ç–∞`);
  }
  miniArea.style.display='none';
  saveState();
  updateUI();
});

/* ======== SHOP (purchase multipliers) ======== */
const COIN_MULT_MS = 10*60*1000; // 10 minutes
const EXP_MULT_MS  = 15*60*1000; // 15 minutes
buyCoins.addEventListener('click', ()=>{
  // extend current coinMultUntil by COIN_MULT_MS (if in future add, else set now+duration)
  const before = Math.max(0, state.coinMultUntil - nowMs());
  state.coinMultUntil = Math.max(state.coinMultUntil, nowMs()) + COIN_MULT_MS;
  saveState();
  updateUI();
  showNotification('buy', `–ö—É–ø–ª–µ–Ω–æ x2 –º–æ–Ω–µ—Ç. –û—Å—Ç–∞–ª–æ—Å—å: ${formatRemaining(state.coinMultUntil - nowMs())}`);
});
buyExp.addEventListener('click', ()=>{
  state.expMultUntil = Math.max(state.expMultUntil, nowMs()) + EXP_MULT_MS;
  saveState();
  updateUI();
  showNotification('buy', `–ö—É–ø–ª–µ–Ω–æ x2 –æ–ø—ã—Ç–∞. –û—Å—Ç–∞–ª–æ—Å—å: ${formatRemaining(state.expMultUntil - nowMs())}`);
});

/* ======== Catch animals page ======== */
function makeGrid(){
  catchGrid.innerHTML = '';
  // 5x5 grid of random emoji cat/dog
  for(let i=0;i<25;i++){
    const cell = document.createElement('div');
    cell.className = 'cell';
    const isCat = Math.random() < 0.5;
    cell.textContent = isCat ? 'üê±' : 'üê∂';
    cell.dataset.pet = isCat ? 'cat' : 'dog';
    cell.addEventListener('click', onCatchClick);
    catchGrid.appendChild(cell);
  }
}
function clearGrid(){
  catchGrid.innerHTML = '';
}
function onCatchClick(e){
  // enforce overall catch cooldown
  if(nowMs() < state.catchAvailableAt){
    const rem = state.catchAvailableAt - nowMs();
    showNotification('exp', `–û—Ç–ª–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ ${formatRemaining(rem)}`);
    return;
  }
  const cell = e.currentTarget;
  if(cell.classList.contains('disabled')) return;
  // random reward: either coins only, exp only, or both
  const typeRoll = Math.random();
  let coinsGain = 0;
  let expGain = 0;
  if(typeRoll < 0.33){
    // coins only
    coinsGain = Math.floor(Math.random()*5)+1; //1..5
  } else if(typeRoll < 0.66){
    expGain = +(Math.random()*(0.5-0.2)+0.2).toFixed(2); //0.2..0.5
  } else {
    coinsGain = Math.floor(Math.random()*5)+1;
    expGain = +(Math.random()*(0.5-0.2)+0.2).toFixed(2);
  }
  // apply multipliers
  const coinsFinal = applyCoinMultiplier(coinsGain);
  const expFinal = applyExpMultiplier(expGain);
  if(coinsFinal>0 && expFinal>0){
    state.coins += coinsFinal;
    increaseProgress(expFinal);
    showNotification('coins', `–í—ã –ø–æ–π–º–∞–ª–∏ ${cell.dataset.pet==='cat'?'–∫–æ—Ç–∞':'—Å–æ–±–∞–∫—É'} –∏ –ø–æ–ª—É—á–∏–ª–∏ +${coinsFinal} –º–æ–Ω–µ—Ç –∏ +${expFinal}% –æ–ø—ã—Ç–∞`);
  } else if(coinsFinal>0){
    state.coins += coinsFinal;
    showNotification('coins', `–í—ã –ø–æ–π–º–∞–ª–∏ ${cell.dataset.pet==='cat'?'–∫–æ—Ç–∞':'—Å–æ–±–∞–∫—É'} –∏ –ø–æ–ª—É—á–∏–ª–∏ +${coinsFinal} –º–æ–Ω–µ—Ç`);
  } else if(expFinal>0){
    increaseProgress(expFinal);
    showNotification('exp', `–í—ã –ø–æ–π–º–∞–ª–∏ ${cell.dataset.pet==='cat'?'–∫–æ—Ç–∞':'—Å–æ–±–∞–∫—É'} –∏ –ø–æ–ª—É—á–∏–ª–∏ +${expFinal}% –æ–ø—ã—Ç–∞`);
  } else {
    showNotification('exp', `–ù–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë`);
  }
  // optional: mark cell disabled after catch (so user sees it's caught)
  cell.classList.add('disabled');
  // set global catch cooldown to 5 minutes from now
  state.catchAvailableAt = nowMs() + 5*60*1000;
  saveState();
  updateUI();
}

/* ======== Navigation ======== */
function showPage(name){
  pageMain.classList.remove('active');
  pageShop.classList.remove('active');
  pageCatch.classList.remove('active');
  if(name==='main'){ pageMain.classList.add('active'); }
  if(name==='shop'){ pageShop.classList.add('active'); }
  if(name==='catch'){ pageCatch.classList.add('active'); }
}
openShop.addEventListener('click', ()=> { showPage('shop'); });
shopHome.addEventListener('click', ()=> { showPage('main'); });
openCatch.addEventListener('click', ()=> { showPage('catch'); makeGrid(); });
catchHome.addEventListener('click', ()=> { showPage('main'); });
refreshGrid.addEventListener('click', ()=> makeGrid());
clearGrid.addEventListener('click', ()=> clearGrid());

/* ======== Periodic tick ======== */
function tick(){
  // restore feed if time passed
  if(state.feedCount <= 0 && state.feedRestoreAt && nowMs() >= state.feedRestoreAt){
    state.feedCount = 5;
    state.feedRestoreAt = 0;
    showNotification('exp','–ö–æ—Ä–º–ª–µ–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (5)');
  }
  // clear expired multipliers
  if(state.coinMultUntil && nowMs() >= state.coinMultUntil){
    state.coinMultUntil = 0;
    showNotification('coins','x2 –º–æ–Ω–µ—Ç –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å');
  }
  if(state.expMultUntil && nowMs() >= state.expMultUntil){
    state.expMultUntil = 0;
    showNotification('exp','x2 –æ–ø—ã—Ç–∞ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å');
  }
  // bonus availability handled in UI
  saveState();
  updateUI();
}
setInterval(tick, 1000);

/* ======== Init load ======== */
loadState();
updateUI();

/* ======== Home button for main page already present above, also ensure shop/catch have home buttons. ======== */

/* ======== Ensure UI consistent after load ======== */
updateUI();

</script>
</body>
</html>
